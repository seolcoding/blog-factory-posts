---
/**
 * ComparisonTable - Side-by-side comparison widget
 *
 * Simple usage (recommended for MDX):
 * @example
 * <ComparisonTable
 *   title="Plan Comparison"
 *   headers={["Feature", "Free", "Pro"]}
 *   rows={[
 *     ["Storage", "5GB", "100GB"],
 *     ["Support", "Email", "24/7"]
 *   ]}
 * />
 *
 * Advanced usage with column highlighting:
 * @example
 * <ComparisonTable
 *   title="Plan Comparison"
 *   columns={[
 *     { name: "Free", highlight: false },
 *     { name: "Pro", highlight: true }
 *   ]}
 *   rows={[
 *     { feature: "Storage", values: ["5GB", "100GB"] },
 *     { feature: "Support", values: [false, true] }
 *   ]}
 * />
 */

export interface Column {
  name: string;
  highlight?: boolean;
  subtitle?: string;
}

export interface AdvancedRow {
  feature: string;
  values: (string | boolean)[];
}

export interface Props {
  title?: string;
  /** Simple mode: array of header strings */
  headers?: string[];
  /** Simple mode: array of row arrays */
  rows?: (string | boolean)[][] | AdvancedRow[];
  /** Advanced mode: column definitions */
  columns?: Column[];
  class?: string;
}

const { title, headers, columns: advancedColumns, rows: rawRows, class: className = "" } = Astro.props;

// Determine if we're in simple mode or advanced mode
const isSimpleMode = headers && Array.isArray(headers) && headers.length > 0;

// Convert simple mode to advanced mode structure
let columns: Column[] = [];
let rows: AdvancedRow[] = [];

if (isSimpleMode && rawRows) {
  // Simple mode: headers is array of strings, rows is array of arrays
  columns = headers.slice(1).map(name => ({ name, highlight: false }));
  rows = (rawRows as (string | boolean)[][]).map(row => ({
    feature: String(row[0] || ''),
    values: row.slice(1)
  }));
} else if (advancedColumns && rawRows) {
  // Advanced mode
  columns = advancedColumns;
  rows = rawRows as AdvancedRow[];
} else {
  // Fallback: empty
  columns = [];
  rows = [];
}

// First column header for simple mode
const firstColumnHeader = isSimpleMode && headers ? headers[0] : 'Features';
---

<div
  class:list={[
    "overflow-hidden rounded-xl border border-border bg-card shadow-sm my-6",
    className,
  ]}
>
  {title && (
    <div class="border-b border-border bg-muted/30 px-6 py-4">
      <h3 class="text-lg font-semibold text-foreground">{title}</h3>
    </div>
  )}

  <div class="overflow-x-auto">
    <table class="w-full">
      <!-- Header -->
      <thead>
        <tr class="border-b border-border">
          <th class="px-4 py-4 text-left text-sm font-medium text-muted-foreground">
            {firstColumnHeader}
          </th>
          {
            columns.map((col) => (
              <th
                class:list={[
                  "px-4 py-4 text-center min-w-[100px]",
                  col.highlight
                    ? "bg-accent/10 border-x border-accent/20"
                    : "",
                ]}
              >
                <div class="font-semibold text-foreground">{col.name}</div>
                {col.subtitle && (
                  <div class="text-sm font-normal text-muted-foreground mt-1">
                    {col.subtitle}
                  </div>
                )}
              </th>
            ))
          }
        </tr>
      </thead>

      <!-- Body -->
      <tbody>
        {
          rows.map((row, rowIndex) => (
            <tr
              class:list={[
                "border-b border-border last:border-0 transition-colors hover:bg-muted/20",
                rowIndex % 2 === 0 ? "" : "bg-muted/10",
              ]}
            >
              <td class="px-4 py-3 text-sm font-medium text-foreground">
                {row.feature}
              </td>
              {row.values.map((value, colIndex) => (
                <td
                  class:list={[
                    "px-4 py-3 text-center text-sm",
                    columns[colIndex]?.highlight
                      ? "bg-accent/5 border-x border-accent/10"
                      : "",
                  ]}
                >
                  {typeof value === "boolean" ? (
                    value ? (
                      <svg
                        class="h-5 w-5 mx-auto text-green-500"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M5 13l4 4L19 7"
                        />
                      </svg>
                    ) : (
                      <svg
                        class="h-5 w-5 mx-auto text-gray-400"
                        fill="none"
                        viewBox="0 0 24 24"
                        stroke="currentColor"
                        stroke-width="2"
                      >
                        <path
                          stroke-linecap="round"
                          stroke-linejoin="round"
                          d="M6 18L18 6M6 6l12 12"
                        />
                      </svg>
                    )
                  ) : (
                    <span class="text-foreground">{value}</span>
                  )}
                </td>
              ))}
            </tr>
          ))
        }
      </tbody>
    </table>
  </div>
</div>
